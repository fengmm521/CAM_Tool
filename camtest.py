#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Date    : 2019-04-16 15:55:39
# @Author  : Your Name (you@example.org)
# @Link    : http://example.org
# @Version : $Id$

import os,sys

# need pyusb and python binding for opencv
# also need libusb installed
import cv2
import usb.core

cam=cv2.VideoCapture(0)

dev = usb.core.find(idVendor=0x18e3, idProduct=0x5031)
# simulate the SET_CUR sequence
dev.ctrl_transfer(0x21,0x01,0x0800,0x0600,[0x50,0xff])
dev.ctrl_transfer(0x21,0x01,0x0f00,0x0600,[0x00,0xf6])
dev.ctrl_transfer(0x21,0x01,0x0800,0x0600,[0x25,0x00])
dev.ctrl_transfer(0x21,0x01,0x0800,0x0600,[0x5f,0xfe])
dev.ctrl_transfer(0x21,0x01,0x0f00,0x0600,[0x00,0x03])
dev.ctrl_transfer(0x21,0x01,0x0f00,0x0600,[0x00,0x02])
dev.ctrl_transfer(0x21,0x01,0x0f00,0x0600,[0x00,0x12])
dev.ctrl_transfer(0x21,0x01,0x0f00,0x0600,[0x00,0x04])
dev.ctrl_transfer(0x21,0x01,0x0800,0x0600,[0x76,0xc3])

k=0
while (k!=ord('q')):
    ret,frame=cam.read()
    cv2.imshow("cam_test",frame)

    k=cv2.waitKey(18)&0xFF
    kv=k-ord('0')
    #  print(kv)
    #  if press 1,2,3 or 4, change the 3d camera mode
    if kv in [1,2,3,4]:
        dev.ctrl_transfer(0x21,0x01,0x0a00,0x0600,[kv,0x00])
